{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generate Timetable</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
    <style>
        /* (Keep the existing styles) */
    </style>
</head>
<body>
    <div class="container">
        <h1>Generate Timetable</h1>
        <form method="post" action="{% url 'generate_timetable' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="year">Enter Year:</label>
                <input type="number" class="form-control" id="year" name="year" min="2000" max="2100" required>
            </div>
            <button type="submit" class="btn btn-primary">Generate Timetable</button>
        </form>

        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div{% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

        {% if timetable_entries %}
        <div id="timetable">
            <h2>Generated Timetable for Year {{ selected_year }}</h2>
            {% for program in programs %}
                <h3 class="secHead">{{ program.program_name }}</h3>
                <table class="table2">
                    <tr>
                        <th>Day</th>
                        <th>Time</th>
                        <th>Module</th>
                        <th>Room</th>
                        <th>Staff</th>
                    </tr>
                    {% for entry in timetable_entries %}
                        {% if entry.module.department == program.department %}
                        <tr>
                            <td>{{ entry.day_of_week }}</td>
                            <td>{{ entry.start_time }} - {{ entry.end_time }}</td>
                            <td>{{ entry.module.module_code }} - {{ entry.module.module_name }}</td>
                            <td>{{ entry.room.room_name }} ({{ entry.room.building_name }} - {{ entry.room.room_no }})</td>
                            <td>{{ entry.staff.staff_name }} ({{ entry.staff.staff_title }})</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </table>
            {% endfor %}
        </div>
        <button class="submit" id="download">Download PDF</button>
        {% endif %}
    </div>

    <script type="text/javascript">
        // (Keep the existing script for PDF download)
    </script>
</body>
</html>